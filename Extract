WITH RankedData AS (
  SELECT 
    REL.FG_NM,
    ERP.EAN_CD,
    ERP.MATERIAL_SKU_CODE,
    ERP.MATL_SHRT_DESC,
    ATT.RGN_CD AS REGION1,
    ERP.RGN_CD AS REGION2,
    ATT.PROD_MGMT_CD,
    REL.FG_CHILD_NM,
    ERP_CHILD.MATERIAL_SKU_CODE AS CHILD_SKU_CODE,
    ATT_CHILD.SPEC_DESC,
    ATT_CHILD.SPEC_TYPE_CD,
    ROW_NUMBER() OVER (PARTITION BY REL.FG_NM, REL.FG_CHILD_NM ORDER BY REL.FG_NM, REL.FG_CHILD_NM) AS rn
  FROM PROD_PRODUCT360_CORE.CORE_ACCESS.DP_P360_TRU_REL REL
  LEFT JOIN PROD_PRODUCT360_CORE.CORE_ACCESS.DP_P360_TRU_ATT ATT 
    ON REL.FG_NM = ATT.SPEC_NM
  LEFT JOIN PROD_PRODUCT360_CORE.CORE_ACCESS.DP_P360_ERP ERP 
    ON ATT.FG_ERP_CD_TXT = LTRIM(ERP.MATL_NUM, 0)
  LEFT JOIN PROD_PRODUCT360_CORE.CORE_ACCESS.DP_P360_TRU_ATT ATT_CHILD 
    ON REL.FG_CHILD_NM = ATT_CHILD.SPEC_NM
  LEFT JOIN PROD_PRODUCT360_CORE.CORE_ACCESS.DP_P360_ERP ERP_CHILD 
    ON ATT_CHILD.FG_ERP_CD_TXT = LTRIM(ERP_CHILD.MATL_NUM, 0)
  WHERE ERP.MATERIAL_SKU_CODE IS NOT NULL
    AND (REL.FG_CHILD_NM IS NOT NULL OR ERP_CHILD.MATERIAL_SKU_CODE IS NOT NULL)
    AND ATT.PROD_MGMT_CD = 'Trade Customization'
    AND ATT.RGN_CD = 'North America'
    AND REL.FG_NM = 'FG-0000069'
)
SELECT *
FROM RankedData
WHERE rn = 1
ORDER BY FG_NM, FG_CHILD_NM;
